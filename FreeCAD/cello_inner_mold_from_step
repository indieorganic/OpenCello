import FreeCAD as App
import Draft
import Part

DOC = App.ActiveDocument

# --- PARAMETERS ---
OFFSET_MM = -2.2   # inner mold offset
DXF_NAME = "cello_inner_mold_2p2mm.dxf"

# --- FIND BACK PLATE ---
solids = [o for o in DOC.Objects if hasattr(o, "Shape")]

# Pick the largest planar face projection (back plate heuristic)
largest = None
area_max = 0

for obj in solids:
    for face in obj.Shape.Faces:
        area = face.Area
        if area > area_max:
            area_max = area
            largest = face

if largest is None:
    raise Exception("No suitable back face found")

# --- PROJECT TO 2D ---
wire = largest.OuterWire
wire2d = Draft.makeWire(wire.Points, closed=True)

# --- OFFSET FOR INNER MOLD ---
offset = Draft.offset(wire2d, OFFSET_MM, copy=True)

DOC.recompute()

# --- EXPORT DXF ---
Draft.export([offset], DXF_NAME)

print("DXF generated:", DXF_NAME)
